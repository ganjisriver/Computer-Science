# 01. 요구 페이징

### 01. 요구 페이징의 개요

- 컴퓨터를 오래 켜두면 성능이 떨어지는 이유

→ 쉬는 프로세스, 좀비 프로세스 등이 메모리를 차지하여 메모리 관리가 복잡해지기 때문

- 용량이 큰 프로세스를 메모리에 올릴 때 모든 모듈을 메모리에 가져오지 않는 이유
  
  - 메모리를 효율적으로 관리하기 위함.
    
    → 메모리가 꽉차면 관리의 용이성 때문에, 적은 프로세스를 유지하기 때문
  
  - 응답 속도 향상
    
    → 용량이 큰 프로세스를 메모리에 올리면 응답이 늦어질 수 있다.

- 요구 페이지의 정의
  
  - 위의 이유로 프로세스의 모든 모듈이 메모리에 올라오지 않는다.
  - 특정 모듈이 필요할 때, 해당 페이지를 메모리로 가져오는 것을 **요구 페이징**이라고 한다.

### 02. 페이지 테이블 엔트리의 구조

- 가상 메모리의 크기
  
  - 가상 메모리의 크기는 물리 메모리의 영역과 스왑 영역을 합친 영역이다.

- 페이지가 스왑 영역에 있는 경우
  
  - 요구 페이징으로 물리 메모리에 올라가지 못한 경우
  - 메모리가 꽉 차서 스왑영역으로 옮겨온 경우

- 페이지 테이블
  
  - 물리 메모리와 스왑 영역을 연결 해주는 매핑 테이블

- 페이지 테이블 엔트리(PTE: Page Table Entry)
  
  - 페이지 테이블의 한 행

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/97b0a30a-7067-4d35-bb63-7f2fabc35aa6/21179c5a-d315-4af9-a90e-3a56be66d614/Untitled.png)

`프레임 번호(주소 필드)`

- 가상 주소의 해당 페이지가 어느 프레임에 있는 지 알려주는 자료 구조
- 메모리 관리자가 이를 통해 가상 주소를 실제 주소로 변환한다.

`플래그 비트`

- 접근 비트(access bit) or 참조 비트
  - 페이지가 메모리에 올라온 후 사용한 적이 있는지 알려 줌
- 변경 비트(modified bit)
  - 페이지가 메모리에 올라온 후 데이터 변경이 있었는지 알려준다.
  - 데이터가 오염되었다는 뜻으로 dirty bit라고도 한다.
- 유효 비트(valid bit)
  - 페이지가 실제 메모리에 있는 지를 나타낸다.
  - 페이지는 물리 메모리와 스왑 영역에 둘 다 있을 수 있기 때문이다.
- 접근 권한 비트(읽기 비트, 쓰기 비트, 실행 비트)
  - 페이지의 읽기, 쓰기, 실행 권한이 있는지 나타낸다.

### 03. 페이지 부재

- 유효 비트에 따른 주소 필드의 의미 변화
  - 유효 비트는 해당 페이지가 물리 메모리에 있는 지, 스왑 영역에 있는 지 알 수 있다.
  - 페이지가 물리 메모리에 있다면, 주소 필드는 메모리의 프레임 번호를 뜻한다.
  - 페이지가 스왑 영역에 있다면, 저장장치 내 주소를 뜻한다.

`페이지 부재`

- 프로세스가 페이지를 요청 했을 때, 그 페이지가 메모리에 없는 경우를 의미
- 프로세스가 페이지를 요청했기 때문에, 해당 페이지를 스왑 영역에서 물리 메모리로 올려야 한다.

→ 해당 페이지가 물리 메모리에 올라왔기 때문에, 페이지 테이블도 그에 맞춰서 갱신 해준다.

`페이지 부재시 페이지 교체 하는 과정`

- 메모리에 빈 프레임이 있을 경우
  1. 페이지 부재 발생
  2. 스왑 영역에서 물리 메모리로 스왑인 함.
  3. 빈 프레임에 물리 메모리가 저장이 되면, 프레임 번호, 유효 비트 갱신

→ 빈 프레임이 있다면 문제가 없지만, 빈 프레임이 없을 경우, 기존 메모리에 올라간 페이지를 스왑 영역으로 내리고 요청한 페이지를 메모리에 올려야 한다.

→ 이 때 사용하는 것이 페이지 교체 알고리즘이다.

- 메모리에 빈 프레임이 없을 경우
  1. 페이지 부재 발생
  2. 메모리가 꽉 차 있어, 메모리에 있는 특정 페이지를 스왑 영역으로 옮긴다.(스왑 아웃)
  3. 대상 페이지의 PTE 유효 비트와 주소 필드값이 바뀐다.
  4. 메모리에 올라오고자 하는 페이지가 방금 빈 프레임으로 들어간다.(스왑 인)
  5. 메모리에 올라간 페이지의 PTE의 유효 비트와 프레임 번호가 바뀐다.

`세그먼테이션 오류 vs 페이지 부재`

- 세그먼테이션 오류
  - 원인
    - 사용자 프로세스가 할당 받은 메모리 영역을 벗어나거나, 접근 권한이 없는 곳에 접근할 때 발생
  - 해결
    - 이 때문에, 해당 프로세스를 강제 종료하여 문제를 해결
- 페이지 부재
  - 원인
    - 요구한 페이지가 물리 메모리에 존재하지 않을 때 발생
  - 해결
    - 메모리 관리자가 스왑 영역에 있는 페이지를 물리 메모리로 옮겨 해결
