# HTTP, HTTPS 동작 과정은 어떻게 이루어질까(feat. DNS, SSL)

#### :date: 날짜: 2023-10-18

### :question: 이 주제를 택한 이유

- 문득, HTTP와 HTTPS는 클라이언트와 서버 간 데이터 전송이 발생할 때, 데이터를 암호화 해주는지에 대한 차이라고 들었다. DNS관련 정보를 찾아보다가 궁금해서 찾아보기로 했다.

> ### HTTP 동작 과정

1. 클라이언트 URL 주소를 입력 및 DNS 서버를 통해 IP를 획득
   
   > ### DNS 동작 과정
   > 
   > 기본적으로 http 요청이 발생할 때 마다, DNS 서버에 IP를 요청하는 과정을 거치게 되면, 오버헤드가 과도하게 발생할 것이다. 그래서, 브라우저는 자주 방문하는 사이트는 DNS 캐시를 통해 IP를 저장하여 DNS 서버를 통하는 오버헤드를 최소화 한다.
   > 
   > **브라우저가 DNS 캐시를 찾는 과정은 다음과 같다.**
   > 
   > 1. **브라우저 내부 캐시를 확인**
   >    
   >     -> 이전에 브라우저에서 방문한 사이트인지 확인하는 절차
   > 
   > 2. **운영체제 내부 캐시 확인** 
   >    
   >    -> 브라우저에 없는 도메인이면, 운영체제 내부에 있는 DNS 캐시에 해당 도메인이 등록되어 있는지 확인한다.
   > 
   > 3. **라우터 캐시 확인** 
   >    
   >    -> OS 캐시에 일치하는 DNS 기록이 없다면 라우터도 DNS 기록을 일시적으로 보관함.
   > 
   > 4. **ISP 캐시 확인**
   > 
   > *ISP(Internet Service Provider): 인터넷 서비스 제공 주체(ex. KT, LG, SKT 등)
   > 
   > 요청한 URL이 캐시에 없으면 ISP의 DNS server가 재귀적으로 도메인을 찾는다.
   > 
   > <img src="file:///C:/Users/ganjisriver/AppData/Roaming/marktext/images/2023-10-21-18-42-36-image.png" title="" alt="" width="479">
   > 
   > **📎 도메인 아키텍쳐 (Domain Architecture)**
   > 
   > > • 루트 도메인 (**Root** Domain)   ex. "."   
   > > • 최상위 도메인 (TLD : **Top Level** Domain)   ex. "edu", "org", "gov", "com", "au"  
   > > • 2차 도메인 (**Second Level** Domain)   ex. "openoffice.org", "expedia.gov", "microsoft.com"  
   > > • 3차 도메인 (**Third Level** Domain)   ex. "www.openoffice.org", "download.microsoft.com"
   > 
   > <img src="https://velog.velcdn.com/images/narcoker/post/abe58d37-d36a-4a90-bf17-264b293e028a/image.png" title="" alt="" width="479">
   > 
   > 이렇게 주소창에 입력한 도메인을 IP주소로 변환하고, 이를 통해 해당 서버와 TCP 연결을 시작한다.

2. 웹 서버와 TCP 연결 시도 (3-way handshaking)을 통해 통신 연결 수립, 소켓 개방진행
   
   - 추후 3-way-handshaking 글 작성 예정

3. 클라이언트가 서버에게 요청 (Request)

4. 서버는 클라이언트에게 응답 (Response)

5. 연결 종료 (4-way handshaking)

6. 클라이언트는 응답을 기반하여 웹 문서 출력

> ### 그렇다면 HTTPS는?
> 
> **HTTP와의 차이는 three-way handshake 과정에서 SSL 인증을 시도한다.**
> 
> 위에서 확인한 것처럼 TCP 연결은 연결 시작할 때, 3-way-handshaking을 통해 연결 상태가 정상인지 확인 한다. HTTPS는 위에서 설명한 HTTP연결 과정 중 3-way-handshaking에서 서버에 있는 ssl 인증서를 확인하고, 서버와 클라이언트 Session Key를 활용해 데이터 암복호화를 요청한다.



<br>

> ### Handshaking 과정에서 SSL인증을 확인하는 과정 개요

1. 클라이언트는 랜덤데이터 생성하여 서버 전달
2. 서버측에서 생성한 무작위 데이터와 해당 서버 인증서를 실어서 클라이언트에게 보냄
3. 브라우저에 내장된 CA정보로 서버 인증서를 비대칭키 시스템을 통해 확인
4. 브라우저에 저장된 CA의 공개키로 인증서 복호화 (*CA인증을 받은 인증서들은 해당 CA의 개인키로 암호화 되어있음) / 만약 복호화가 되지 않는다면 정상적인 서버 인증서가 아님으로 브라우저 주소창에 Not secure뜸
5. 복호화된 인증서로 서버 공개키 획득
6. 핸드쉐이킹 과정을 통해 주고받은 데이터를 혼합해서 임시키를 생성
7. 서버의 공개키로 암호화되서 서버로 보내짐
8. 양쪽에서 일련의 과정을 거쳐 동일한 대칭키 획득 
9. 이후 서로 주고받는 메시지는 대칭키로 보안유지

*CA: Certification Authority의 약어로, 인증 기관을 의미한다. 

> ### SSL 인증을 알기 위해 먼저 알아야할 공개키, 대칭키
> 
> 

> ### SSL 인증 동작 세부 과정
> 
> ![](C:\Users\ganjisriver\AppData\Roaming\marktext\images\2023-10-23-21-08-49-image.png)

> ### 참고 자료

https://velog.io/@narcoker/네트워크-HTTP와-HTTPS-동작-과정

https://velog.io/@kti0940/HTTPS-SSL-복호화는-어디서-진행될까

https://wayhome25.github.io/cs/2018/03/11/ssl-https/

[HTTPS 통신과정 쉽게 이해하기 #5(CA, 인증기관)](https://aws-hyoh.tistory.com/59)

[HTTPS와 SSL 인증서 - 생활코딩](https://opentutorials.org/course/228/4894)

https://www.cloudflare.com/ko-kr/learning/ssl/what-is-a-session-key/
