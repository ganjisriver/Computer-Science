# 03. 스레싱 할당

### 1. 스레싱

`스레싱의 개념`

- 정의
  - 잦은 페이지의 부재로 작업이 멈춘 것 같은 현상
- 원인
  - 메모리의 공간 부족으로, 잦은 페이지 부재가 발생하여 오버헤드가 많이 발생함.

`물리 메모리의 크기 스레싱`

- 멀티프로그래밍 정도
  
  - 정의
    
    - 동시에 실행하는 프로그램의 수
    
    멀티프로그래밍 정도가 너무 높으면 스레싱 발생
  
  - CPU 사용률관계
    
    - CPU 사용률이 지속적으로 증가하다가 메모리가 꽉 차면, CPU 작업 시간보다 스왑 작업이 더 빈번해져 CPU가 작업할 수 없는 상태가 된다.
    
    → 이 현상이 발생하는 시점이 스레싱 발생 지점이라고 한다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/97b0a30a-7067-4d35-bb63-7f2fabc35aa6/8371c621-966b-455f-99c2-956ae69dbc74/Untitled.png)

- 물리 메모리가 너무 작다면, 스레싱 발생 지점에 빠르게 도달하여, 성능 저하가 발생한다.

→ 적당한 물리 메모리 공간이 필요하다.

`스레싱과 프레임 할당`

- 프레임 할당
  - 실행 중인 프로세스들에 프레임을 얼마나 나누어 주는 지에 따라 성능 차이가 발생한다.
  - 너무 적은 프레임을 할당하면, 페이지 부재가 빈번하게 발생
  - 너무 많은 프레임을 할당하면, 메모리 낭비가 발생

### 2. 정적 할당

- 정의
  - 프로세스 실행 초기에 프레임을 나누어 준 후 그 크기를 고정하는 것
  - 균등 할당 방식과 비례 할당 방식으로 나뉜다.

`균등 할당`

- 정의
  - 프로세스의 크기와 관계 없이 모든 프로세스에 동일한 크기의 프레임을 할당한다.
- 특징
  - 크기가 큰 프로세스는 필요한 만큼의 프레임을 할당받지 못하여, 페이지 부재가 빈번하게 발생한다.

`비례 할당`

- 정의
  - 프로세스의 크기에 비례하여 프레임을 할당하는 방식
- 문제점
  - 프로세스가 실행 중에 필요로 하는 **프레임을 유동적으로 반영할 수 없음**
  - 동영상 플레이어는 프로그램 자체 크기는 적지만, 동영상을 플레이할 때는 프레임 할당이 많이 필요하다.
  - 사용하지 않을 메모리를 처음부터 미리 확보하여 공간을 낭비한다.
  - 요구 페이징 방식에서는 페이지를 처음부터 메모리에 올리지 않지만, 비례 할당 방식은 당장 필요하지 않는 프레임을 미리 할당하여 **메모리 낭비**가 발생한다.

### 3. 동적 할당

- 정의
  - 정적 할당과 다르게 프로세스의 요청에 따라 프레임을 할당할 수 있다.

`작업집합 모델`

- 정의
  - 최근 일정 시간 동안 참조된 페이지들을 집합으로 만들어, 집합 내에 있는 페이지를 물리 메모리에 유지 시키는 방식
- 작업집합 크기
  - 물리 메모리에 유지할 페이지의 크기
  - 작업집합에 들어갈 페이지의 최대 개수를 의미한다.
- 작업집합 윈도우
  - 작업집합에 포함되는 페이지의 범위
  - 현재 시점에서 어느 범위까지의 페이지를 볼 것인지

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/97b0a30a-7067-4d35-bb63-7f2fabc35aa6/1cbdb3d6-6b50-4d29-a176-70ef7f9a6f4d/Untitled.png)

- 특징
  
  - 작업집합 윈도우의 크기에 따라 프로세스의 성능이 크게 변화한다.
  - 윈도우를 크게 잡으면, 필요 없는 페이지가 메모리에 많이 남아 다른 프로세스에 영향을 미친다.
  - 윈도우를 작게 잡으면, 페이지 부재가 많이 발생하여 성능이 떨어진다.
  
  → 충분한 페이지를 할당하지 안흐면, 작업집합에 있는 페이지를 물리 메모리에 유지하기 힘듬, 프레임을 얼마나 할당해야 하는지에 대한 답은 주지 않음.

`페이지 부재 빈도`

- 원리
  - 페이지 부재 빈도를 기록하여, 페이지 부재 비율을 계산 해, 페이지 부재 비율의 상한선과 하한선을 둔다.
  - 페이지 부재 비율이 높으면, 프레임이 부족하다는 의미라, 프레임을 추가 할당하고, 페이지 부재 비율이 낮으면, 프레임이 많다는 의미로, 할당한 프레임을 회수한다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/97b0a30a-7067-4d35-bb63-7f2fabc35aa6/de691d2d-8599-49bb-af77-32ac17c1597a/Untitled.png)

### 4. 전역 교체와 지역 교체

페이지 교체의 적용 범위에 따라, 전역 교체와 지역 교체로 나뉜다.

`전역 교체`

- 정의
  - 전체 프레임을 대상으로 교체 알고리즘을 진행한다.

`지역 교체`

- 정의
  
  - 현재 실행중인 프로세스의 프레임을 대상으로 교체 알고리즘을 적용한다.

- 장점
  
  - 자신에게 할당된 프레임의 전체 개수에 변화가 없어 페이지 교체가 다른 프로세스에 영향을 끼치지 않는다.
  - 전체 프로세스에 할당된 프레임의 개수가 변하지 않기 때문에, 스레싱을 줄일 수 있다.

- 단점
  
  - 자주 사용하는 페이지가 스왑 영역으로 옮겨지면, 시스템 효율이 떨어진다.
  - 다른 프로세스의 입장에서는 효율성이 높아지지만, 실행 중인 프로세스의 입장에서 효율성이 떨어진다.
  
  → 전체 시스템의 입장에서 전역 교체 방식이 지역 교체 방식보다 효율적이다.
